(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7587b66f"],{"49e5":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s}));var r=n("b775");function a(e){return Object(r["a"])({url:"/student/getNotice",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/student/setLeave",method:"post",data:e})}},"50fc":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o}));var r=n("b775");function a(e){return Object(r["a"])({url:"/admin/getUsersByTypeAndChar",method:"get",params:e})}function s(e){return Object(r["a"])({url:"/admin/announce",method:"post",data:e})}function i(e){return Object(r["a"])({url:"/admin/noticeDel",method:"get",params:e})}function o(e){return Object(r["a"])({url:"/admin/getuserLeave",method:"get",params:e})}},6235:function(e,t,n){"use strict";n("7ad1")},"7ad1":function(e,t,n){},a15b:function(e,t,n){"use strict";var r=n("23e7"),a=n("44ad"),s=n("fc6a"),i=n("a640"),o=[].join,c=a!=Object,l=i("join",",");r({target:"Array",proto:!0,forced:c||!l},{join:function(e){return o.call(s(this),void 0===e?",":e)}})},ab43:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"notice"}},[n("el-card",{staticClass:"title-card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"title"},[e._v("填写通知")])]),n("el-form",{ref:"noticeRef",attrs:{model:e.releaseInfo,rules:e.rules}},[n("el-row",{staticStyle:{"margin-top":"0.5rem"},attrs:{gutter:20,type:"flex",justify:"center"}},[n("el-col",{attrs:{span:5}},[n("div",[n("el-form-item",{attrs:{prop:"title"}},[n("el-input",{attrs:{placeholder:"请输入通知标题",clearable:""},model:{value:e.releaseInfo.title,callback:function(t){e.$set(e.releaseInfo,"title",t)},expression:"releaseInfo.title"}})],1)],1)]),n("el-col",{attrs:{span:5}},[n("div",[n("el-form-item",{attrs:{prop:"classes"}},[n("el-select",{attrs:{multiple:"",placeholder:"请选择班级"},model:{value:e.releaseInfo.classes,callback:function(t){e.$set(e.releaseInfo,"classes",t)},expression:"releaseInfo.classes"}},e._l(e.classes,(function(e){return n("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1)],1)]),n("el-col",{attrs:{span:5}},[n("div",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return t.stopPropagation(),e.noticeRel(t)}}},[e._v("发布"),n("i",{staticClass:"el-icon-upload el-icon--right"})])],1)])],1)],1)],1),n("el-divider",[n("i",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"el-icon-loading"})]),n("el-card",{staticClass:"box-card"},[n("div",{staticClass:"text item"},[[n("el-table",{attrs:{data:e.noticeList,stripe:"",border:""}},[n("el-table-column",{attrs:{prop:"n_id",label:"序列号",sortable:""}}),n("el-table-column",{attrs:{prop:"title",label:"主题"}}),n("el-table-column",{attrs:{prop:"type",label:"状态"}}),n("el-table-column",{attrs:{prop:"createtime",label:"创建时间"}}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text"}},[e._v("详情")]),n("el-button",{attrs:{type:"text"},on:{click:function(n){return e.noticeDel(t.row)}}},[e._v("删除")])]}}])})],1)],n("el-pagination",{attrs:{"current-page":e.queryInfo.currPage,"page-sizes":[1,2,5,10],"page-size":e.queryInfo.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],2)])],1)},a=[],s=n("1da1"),i=n("5530"),o=(n("96cf"),n("159b"),n("a15b"),n("49e5")),c=n("50fc"),l=n("2f62"),u={name:"index",created:function(){this.getNotice()},mounted:function(){!this.socket&&this.$store.dispatch("socket/socketInit"),this.socket.wsInit()},data:function(){return{loading:!1,queryInfo:{currPage:1,pageSize:5},total:0,noticeList:null,releaseInfo:{title:"",classes:""},rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"},{min:3,message:"至少3个字符",trigger:"blur"}],classes:[{required:!0,message:"至少选择一个班级",trigger:"blur"}]}}},computed:Object(i["a"])({},Object(l["b"])(["classes","socket"])),methods:{getNotice:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,Object(o["a"])(e.queryInfo);case 3:n=t.sent,200===n.meta.status?function(){n.data.data.forEach((function(e){e.type="未读"})),e.total=n.data.total,e.noticeList=n.data.data,e.loading=!1}():e.$notify.error(n.meta.msg);case 5:case"end":return t.stop()}}),t)})))()},noticeRel:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.noticeRef.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(n){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n){t.next=2;break}return t.abrupt("return");case 2:return e.loading=!0,t.next=5,Object(c["a"])({title:e.releaseInfo.title,classes:e.releaseInfo.classes.join(";")});case 5:r=t.sent,200===r.meta.status?function(){e.$notify.success(r.meta.msg),e.getNotice(),e.socket.wsSend({type:"notice",msg:"有新的通知"})}():e.$notify.error(r.meta.msg);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 1:case"end":return t.stop()}}),t)})))()},noticeDel:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,Object(c["d"])({n_id:e.n_id});case 2:r=n.sent,200===r.meta.status?function(){t.$notify.success(r.meta.msg),t.getNotice()}():t.$notify.error(r.meta.msg);case 4:case"end":return n.stop()}}),n)})))()},handleSizeChange:function(e){this.queryInfo.pageSize=e,this.getNotice()},handleCurrentChange:function(e){this.queryInfo.currPage=e,this.getNotice()}}},f=u,d=(n("6235"),n("2877")),p=Object(d["a"])(f,r,a,!1,null,"4bc53f0c",null);t["default"]=p.exports}}]);